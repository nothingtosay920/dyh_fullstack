# ES3 执行上下文

  - 执行上下文是一个评估和执行JavaScript代码的环境抽象概念 可以理解为一个object，每当js代码在运行时，它都是在执行上下文中运行。

    包含：变量对象 VO 
          活动对象 AO
          作用域链
          调用者信息 this

    - 变量对象
      即表示变量的对象 其中 全局执行的变量对象始终存在，函数这种局部环境的变量，只会在函数执行的过程中存在。

    - 活动对象
      函数进入执行阶段时，不能访问的变量对象被激活为活动对象，此时可以访问其中的属性
      注：变量对象和活动对象是同一种东西 只是状态和阶段不同


    - 作用域链（scope chain）
      作用域：可访问变量的集合。作用域确定了当前执行代码对变量的访问权限。
      作用域链：查找变量时，从当前上下文的变量对象中查找，没找到就从父级（词法层面的父级）执行上下文的变量对象中查找，直到全局上下文变量对象，即全局对象。由多个执行上下文的变量对象构成的链表就是作用域链。
    
    - 当前可执行代码块的调用者（this）
      如果当前函数被作为对象方法调用或使用bind call apply 等API 进行委托调用，则将当前代码块的调用者信息（this value）存入当前执行上下文，否则默认为全局对象调用。

    执行上下文结构模拟为:
      executionContext：{
        [variable object | activation object]：{
            arguments,
            variables: [...],
            funcions: [...]
        },
        scope chain: variable object + all parents scopes
        thisValue: context object
      }

# ES3中的执行上下文生命周期
  执行上下文的生命周期有三个阶段: 创建阶段，执行阶段，销毁阶段

  1. 创建阶段：
    - 全局执行上下文
      - 执行全局代码前，会创建变量对象、作用域链和确定this指向，即创建一个全局执行上下文。
        - 对全局数据进行预处理
          进行变量和函数的初始化声明
          var定义的全局变量->undefined添加为全局属性，在浏览器中为window属性。
          function声明的全局函数->将函数添加为window属性
          this -> 指向全局对象

    - 函数执行上下文
      - 在调用函数时，准备执行函数体之前，创建对应的函数执行上下文对象
        - 对局部数据进行预处理
          形参变量 -> 添加为执行上下文属性
          arguments -> 将实参列表添加为执行上下文属性 
          var定义的局部变量 -> undefined 添加为执行上下文属性
          function 声明的函数 -> 将函数添加为执行上下文属性
          构建作用域链
          this -> 确定this指向s
    
    注：变量提升发生在这个阶段

  2. 执行阶段
    - JS代码逐条执行，进行对定义的变量赋值、开始顺着作用域链访问变量、如果内部有函数调用就创建一个新的执行上下文压入执行栈并把控制权交出……

  3. 销毁阶段
    - 一般来讲当函数执行完成后，当前执行上下文（局部环境）会被弹出执行上下文栈并且销毁，控制权被重新交给执行栈上一层的执行上下文。闭包不同。
 